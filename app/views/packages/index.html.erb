<% provide(:title, 'View Packages') %>
<h6>Packages->View</h1>
<div class="row-fluid">
  <div class="span12">
  <form action="/packages", class="form-search", method ="get">
    <div class="span1">
	  <%= collection_select(:account,  :account_id, Account.all, :id, :id, {:prompt => "Account"}, {:id => 'account_search', include_blank: 'None'})%>
    </div>
    <div class="span1">
	   <%= collection_select(:project, :project_id,  @projects,  :id, :id, {:prompt   => "Project"}, { :id => 'project_search'})%>
    </div>
    <div class="span1">
      <%= text_field_tag :batch_search, params[:batch_search], :placeholder => "Batch" %>
    </div>
    <div class="span1">
      <%= text_field_tag :activity_search, params[:activity_search], :placeholder => "Activity" %>
    </div>
    <div class="span2">
      <%= text_field_tag :start_time_search, params[:start_time_search], :type=> "datetime-local", :title => "Start Date" %>
    </div>
    <div class="span2">
      <%= text_field_tag :end_time_search, params[:end_time_search], :type=> "datetime-local", :title => "End Date" %>
    </div>
    <div class="span3">
	  <div class="input-append">
      <%= text_field_tag :id_search, params[:id_search], :size => 13, :class => 'search-query', :placeholder => "IEID or Package Name" %>
      <%= button_tag(type: "submit", class: "btn") do %>
         <i class="icon-search"></i>
         <% end %>
	  </div>
	</div>
  </form>
</div>
</div>

<%= will_paginate %>

<table id="packages" class="table table-condensed table-striped">
  <thead>
    <tr>
      <th><%= sortable "id" %></th>
      <th>Package Name</th>
      <th><%= sortable "account" %></th>
      <th><%= sortable "project" %></th>
      <th>Size</th>
      <th># Files</th>
      <th>Latest Activity</th>
      <th>Time</th>
      <th>Title</th>
      <th>Volume</th>
      <th>Issue</Th.
    </tr>
    <!-- <tr>
       <th><%= text_field_tag :search_id, params[:search_id], :size => 10 %></th>
       <th><%= text_field_tag :search_name, params[:search_name], :size => 10  %></th>
       <th><%= text_field_tag :search_account, params[:search_account], :size => 5  %></th>
       <th><%= text_field_tag :search_project, params[:search_project], :size => 5  %></th>
       <th></th>
       <th></th>
       <th><%= text_field_tag :search_activity, params[:search_activity], :size => 5  %></th>
       <th></th>
       <th></th>
       <th></th>
       <th></th>
     </tr> -->
  </thead>
  <tbody>
    <% @packages.each do |package| %>
    <tr>
      <td><%= package.id %></td>
      <td><%= package.sip.name %></td>
      <td><%= package.project.account_id %></td>
      <td><%= package.project.id %></td>
      <td><%= package.sip.size_in_bytes %></td>
      <td><%= package.sip.number_of_datafiles %></td>
      <td><%= package.normal_events.last.polite_name %></td>
      <td><%= package.normal_events.last.timestamp.strftime("%a %b %d %Y %I:%M:%S %p") %></td>
      <% unless package.intentity.nil?%>
        <td><%= package.intentity.title %></td>
        <td><%= package.intentity.volume %></td>
        <td><%= package.intentity.issue %></td>
      <% end %>
    </tr>
    <% end %>
  </tbody>
</table>

<%= will_paginate %>
