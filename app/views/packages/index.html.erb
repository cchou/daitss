<% provide(:title, 'View Packages') %>
<h6>Packages->View</h6>
<div class="row">
  <form action="/packages" class="form-search" method ="get">
    <div class="col-md-1">
      <%= collection_select(:account,  :account_id, Account.all, :id, :id, {:prompt => "Account"}, {:id => 'account_search', :selected=> params[:account] && params[:account]["account_id"]})%>
    </div>
    <div class="col-md-1">
      <%= collection_select(:project, :project_id,  @projects,  :id, :id, {:prompt   => "Project"}, { :id => 'project_search', :selected=> params[:project] && params[:project]["project_id"] })%>
    </div>
    <div class="col-md-1">
      <%= text_field_tag :batch_search, params[:batch_search], :placeholder => "Batch" %>
    </div>
    <div class="col-md-2">
      <%= select_tag :activity_search, options_for_select(["activities", "submitted", "rejected", "archived", "disseminated", "error", "withdrawn"], params[:activity_search]) %>
    </div>
    <div class="col-md-2">
      <%= text_field_tag :start_time_search, params[:start_time_search], :type=> "date", :title => "Start Date" %>
    </div>
    <div class="col-md-2">
      <%= text_field_tag :end_time_search, params[:end_time_search], :type=> "date", :title => "End Date" %>
    </div>
    <div class="col-md-2">
      <%= text_field_tag :id_search, params[:id_search], :size => 13, :class => 'search-query', :placeholder => "IEID or Package Name" %>
    </div>
    <div class="col-md-1">
      <%= submit_tag "Submit", :class=>"btn", :name => nil %>

      <!-- 
      <span class="input-group-addon">
      <%= button_tag(type: "submit", class: "btn btn-xs") do %>
      <span class="glyphicon glyphicon-search"></span>
      <% end %> -->
      <!-- </span> -->
    </div>
  </div>
</form>
</div>

<%= will_paginate @results%>
<table class="table table-condensed table-hover">
  <thead>
    <tr>
      <th>Select</th>
      <th><%= sortable "IEID" %></th>
      <th><%= sortable "Package Name" %></th>
      <th><%= sortable "Account" %></th>
      <th><%= sortable "Project" %></th>
      <th><%= sortable "Size" %></th>
      <th><%= sortable "# Files" %></th>
      <th><%= sortable "Latest Activity" %></th>
      <th><%= sortable "Timestamp" %></th>
      <th><%= sortable "Title" %></th>
      <th><%= sortable "Volume" %></th>
      <th><%= sortable "Issue" %></th>
    </tr>
  </thead>
  <tbody>
    <% @results.each do |result| %>
    <tr>
      <td><%= check_box_tag 'select_packages' %></td>
      <td><%= link_to result.id, show_package_path(:id => result.id) %></td>
      <td><%= result.name %></td>
      <td><%= result.account_id %></td>
      <td><%= result.project_id %></td>
      <td><%= result.size_in_bytes %></td>
      <td><%= result.number_of_datafiles %></td>
      <td><%= result.event_name%></td>
      <td><%= result.timestamp.strftime("%a %b %d %Y %I:%M:%S %p") %></td>
      <td><%= result.title %></td>
      <td><%= result.volume %></td>
      <td><%= result.issue %></td>
    </tr>
    <% end %>
  </tbody>
</table>
<%= will_paginate @results%>
