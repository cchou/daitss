<% provide(:title, 'View Packages') %>
<h1>View Packages</h1>

<%= form_tag packages_path, :method => 'get' do %>
    <%= text_field_tag :search, params[:search] %>
    <%= submit_tag "Search", :name => nil %>
<% end %>

<%= will_paginate %>

<table id="packages" class="table table-condensed table-striped">
  <thead>
    <tr>
      <th><%= sortable "id" %></th>
      <th>Package Name</th>
      <th>Account</th>
      <th>Project</th>
      <th>Size</th>
      <th># Files</th>
      <th>Latest Activity</th>
      <th>Time</th>
      <th>Title</th>
      <th>Volume</th>
      <th>Issue</th>
    </tr>
    <tr>
      <th><%= text_field_tag :search_id, params[:search_id], :size => 10 %></th>
      <th><%= text_field_tag :search_name, params[:search_name], :size => 10  %></th>
      <th><%= text_field_tag :search_account, params[:search_account], :size => 5  %></th>
      <th><%= text_field_tag :search_project, params[:search_project], :size => 5  %></th>
      <th></th>
      <th></th>
      <th><%= text_field_tag :search_activity, params[:search_activity], :size => 5  %></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <% @packages.each do |package| %>
    <tr>
      <td><%= package.id %></td>
      <td><%= package.sip.name %></td>
      <td><%= package.project.account_id %></td>
      <td><%= package.project.id %></td>
      <td><%= package.sip.size_in_bytes %></td>
      <td><%= package.sip.number_of_datafiles %></td>
      <td><%= package.normal_events.last.polite_name %></td>
      <td><%= package.normal_events.last.timestamp.strftime("%a %b %d %Y %I:%M:%S %p") %></td>
      <% unless package.intentity.nil?%>
        <td><%= package.intentity.title %></td>
        <td><%= package.intentity.volume %></td>
        <td><%= package.intentity.issue %></td>
      <% end %>
    </tr>
    <% end %>
  </tbody>
</table>

<%= will_paginate %>